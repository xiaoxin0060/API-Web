## 小新接口开发平台 · Vue 前端产品设计与 UX 验收标准（企业级）

### 1. 背景与目标
- 背景：后端已具备用户与权限、接口全生命周期管理、用户-接口额度管理、在线调用控制台、帖子模块，以及网关层的鉴权/限流/熔断；接口文档通过 Knife4j 暴露。
- 目标：交付一套基于 Vue 的前端（用户门户 + 管理后台），覆盖核心业务全流程，达到企业级可用性与可维护性；并提供可执行的 UX 验收标准与 E2E 用例。

### 2. 架构与技术选型
- 形态：单体 SPA，按角色分区（用户门户、管理后台），预留微前端（qiankun/Module Federation）升级能力。
- 前后端链路：Browser → Vue SPA → 平台服务(`/api`) → 网关（鉴权、限流、熔断）→ 提供方/Mock。
- 技术栈：
  - 框架与构建：Vue 3（Composition API）+ TypeScript + Vite + Vue Router 4
  - 状态：Pinia（应用/权限/主题）+ TanStack Query for Vue（服务端状态、SW R 缓存、重试）
  - UI：Element Plus 2（企业级组件库）+ SCSS/UnoCSS
  - 表单与校验：Vee-Validate + Zod（或 Yup）
  - 网络：Axios（统一拦截、错误码处理、超时与重试、取消请求）
  - 可视化：ECharts（趋势、分布、Top 榜单）
  - 国际化与质量：vue-i18n、ESLint + Prettier + Stylelint + Husky + lint-staged + Commitlint
  - 测试：Vitest + Vue Test Utils（单元/组件）、MSW（接口 Mock）、Playwright（E2E）
  - 监控：Sentry（前端错误）+ Web Vitals（LCP/FID/CLS）

### 3. 角色与权限
- 角色：
  - 普通用户：注册/登录/退出；浏览与搜索 API；在线调试；查看个人 AK/SK（脱敏）；查看配额与调用记录；帖子管理。
  - 管理员：用户管理；接口新增/编辑/删除/发布/下线/审批；用户-接口额度维护；AK/SK 重置；运营看板。
- 前端鉴权：路由 `meta.roles` + 组件级指令；Pinia 存储 `userRole`；401 统一跳转登录并在成功后回跳原路径。
- 后端鉴权：接口级权限/审计，前后端双重控制防越权。

### 4. 功能清单（页面与 API 映射）
- 身份与账号：
  - 登录：POST `/api/user/login`；注册：POST `/api/user/register`；退出：POST `/api/user/logout`；当前用户：GET `/api/user/get/login`
- 用户中心：
  - 资料查看/更新：POST `/api/user/update`、GET `/api/user/get?id=`
  - AK/SK：脱敏 GET `/api/user/aksk/masked`；管理员重置 POST `/api/user/resetAkSk?userId=`
  - 我的额度：基于 `/api/userInterfaceInfo/*` 查询展示与增配记录
- API 市场（用户门户）：
  - 列表/搜索/筛选：GET `/api/interfaceInfo/list`、`/list/page`
  - 详情：GET `/api/interfaceInfo/get`（管理员可用 `get/decrypted` 展示认证配置）
  - 在线调试：`requestSchema` → 动态参数表单，调用 POST `/api/interfaceInfo/invoke`，展示请求/响应/耗时
  - 状态与配额：展示在线/下线与剩余额度
- 接口管理（管理员）：
  - 新增/编辑/删除：POST `/api/interfaceInfo/add|update|delete`
  - 发布/下线：POST `/api/interfaceInfo/online|offline`
  - 审批：编辑页维护 `approvalStatus`（若启用）
  - Schema：`requestSchema/responseSchema` JSON 编辑 + 实时校验 + 预览动态表单
- 额度与用户-接口关系（管理员）：
  - 列表/分页/详情：GET `/api/userInterfaceInfo/list|/list/page|get`
  - 新增关系：POST `/api/userInterfaceInfo/add`；增加额度：POST `/api/userInterfaceInfo/addQuota`
  - 更新/删除：POST `/api/userInterfaceInfo/update|delete`
- 帖子功能：
  - 列表/分页/详情：GET `/api/post/list|/list/page|get`
  - 新增/编辑/删除：POST `/api/post/add|update|delete`
- 运维看板（管理员）：
  - 调用量、成功率、P95 延时、熔断触发、限流命中、错误码分布、Top 接口/用户（若暂无专门接口，先埋点与日志离线汇总）

### 5. 数据与类型策略
- BaseResponse：`{ code: number; data: T; message: string }`
- 核心模型：`User`/`UserVO`、`InterfaceInfo`、`UserInterfaceInfo`、`Post`
- 类型生成：基于 Knife4j/OpenAPI JSON 使用 `openapi-typescript-codegen` 自动生成 TS 类型与 API Client。

### 6. 请求、缓存与错误处理
- Axios：
  - baseURL = `VITE_API_BASE_URL`（开发代理至 `http://localhost:8101/api`）
  - 请求：附带 `X-Request-Id`、CSRF 头；必要时对 POST 采用幂等键
  - 响应：统一解析 BaseResponse；`code !== 0` 统一 Toast；`401` 重定向登录
  - 超时与重试：超时 10s；对 GET/幂等接口 `retry: 2`
- TanStack Query：
  - 列表分页缓存按 queryKey；Stale-While-Revalidate；错误边界与重试提示
- 体验：NProgress；失败重试入口；弱网降级（骨架屏 + 缓存回显）

### 7. 非功能需求（性能/安全/可用性/可访问性/兼容）
- 性能：
  - 首屏 LCP ≤ 2.5s（P75）；列表中位响应 ≤ 600ms；首屏资源 < 250KB gzip
  - 路由分包、组件按需、CDN 静态资源（生产）
- 安全：
  - HttpOnly Cookie + SameSite；CSRF Token；严格 Referrer-Policy
  - XSS：输出转义、富文本白名单；AK/SK 仅脱敏展示
- 可用性：PWA 可选；统一错误兜底与重试
- 可访问性：表单 label、键盘可达、色彩对比度
- 兼容性：Chrome/Edge 最新两个大版本

### 8. 环境、构建与发布
- 环境变量：`.env.[mode]`（`VITE_API_BASE_URL`、`VITE_ENABLE_MOCK`）
- 开发代理：`vite.config.ts` 代理 `/api` → `http://localhost:8101`
- CI/CD：Lint + Test + Build + Artifact；灰度发布与回滚；SemVer 版本与变更记录

### 9. 测试策略与覆盖
- 单元（≥ 70%）：工具函数、权限守卫、表单校验、Pinia Store
- 组件/集成：请求拦截器、错误码处理、分页缓存、Schema 表单渲染
- E2E（关键路径）：
  - 登录/登出/401 重定向
  - API 市场：搜索→详情→在线调试（成功/失败）
  - 接口管理：新增→发布→下线；编辑 Schema 并校验
  - 额度：新增关系→增加额度→剩余额度刷新
  - AK/SK：脱敏查看；管理员重置后再次获取
  - 帖子：新增→审核态变更→删除

### 10. 用户交互体验（UX）验收标准
- 总原则与度量口径：
  - 响应及时性：点击到视觉反馈 ≤ 100ms；悬停反馈 ≤ 50ms；加载 > 300ms 显示骨架屏；> 1s 显示进度提示且可取消
  - 一致性：操作顺序、按钮主次/危险色一致；相同场景相同交互
  - 稳定性：路由切换无明显布局抖动（CLS≈0）；图片/代码块占位防跳动
  - 可用性/A11y：Tab 顺序正确、焦点可见；键盘可完成核心流程；基础 ARIA 语义
- 导航与信息架构：
  - 可定位：可读 URL 与参数；刷新/回退状态不丢失
  - 面包屑与高亮：当前位置清晰；侧边导航高亮准确
  - 未保存提示：编辑中离开二次确认
- 反馈与可逆性：
  - Toast：成功 2s 消隐；失败保留并给出引导
  - 危险操作：删除/下线/重置需二次确认并说明影响
  - 撤销：轻量改动提供 5s 内撤销或“恢复默认”
  - 批量操作：进度可视、失败项可重试
- 表单与校验：
  - 显性规则：必填星号、长度/格式说明；禁用无效提交
  - 即时校验：失焦 ≤ 300ms；服务端错误映射到字段
  - 键盘：Enter 提交、Esc 关闭、Tab/Shift+Tab 顺序正确
  - JSON/Schema：语法错误即时标红并定位
- 列表与表格：
  - 搜索无结果空态 + 清除筛选 CTA
  - 分页/排序写入 URL；刷新不丢失
  - 多选操作 ≤ 2 次点击到达；选中计数清晰
  - 列控制：显示/隐藏/宽度持久化；数字列右对齐
- 加载、空与错误：
  - 骨架屏覆盖率 ≥ 80%
  - 空态：图标+一句话说明+主操作按钮
  - 错误页：401 跳登录、403 提示权限、404 返回上一页、5xx 可重试/反馈
  - 离线：顶栏离线横幅与“重试”按钮
- 交互效率与快捷键：
  - 快捷键：`/` 聚焦搜索；`Ctrl/⌘+S` 保存；`Esc` 关闭
  - 就地编辑优先；一键复制（JSON、AK/SK、cURL）带反馈
- 响应式与设备：
  - 桌面优先：≥1280px 完整；1024px 正常；<768px 基本浏览
  - 三档断点无重叠/遮挡/超出
- 国际化与本地化：
  - 中/英切换即时生效并记忆
  - 数字/时间按本地化格式展示
- 视觉与可读性：
  - 字号 ≥ 14px；行距 ≥ 1.5；行宽 60–90 字符
  - 对比度 ≥ 4.5:1；禁用态明显
  - 图标语义：带文案或 Tooltip
- 微交互与动效：
  - 动效时长 200–300ms；可中断；不阻塞操作
  - 加载→成功/失败过渡平滑
- 安全相关 UX：
  - AK/SK 默认脱敏；复制二次确认；“仅展示一次”明确提示
  - 敏感操作成功后提示“已记录操作日志”
  - 无权限页给出业务友好文案与申请入口
- 无障碍（A11y）：
  - 核心流程全键盘可达；焦点环可见
  - 读屏：关键区域含 ARIA；Toast 使用 `aria-live`
  - 图片/图标提供 alt/label
- 性能感知（体感）：
  - 骨架屏 100ms 内出现；按钮 Loading 态及时
  - 悬停导航 200ms 预取；回退展示缓存并后台刷新

### 11. 业务特定 UX 标准
- API 调试台（POST `/api/interfaceInfo/invoke`）：
  - `requestSchema` → 动态参数表单；必填/类型/范围即时校验
  - 发起后可取消；展示请求/响应头、状态码、耗时；JSON 自动格式化/折叠
  - 一键复制结果/导出 cURL；最近 5 次参数本地记忆
  - 接口下线或额度为 0 时禁用“调用”并指引“申请额度/联系管理员”
- 接口发布/下线（`online|offline`）：
  - 状态徽标（在线/下线/审批中）列表与详情同步
  - 二次确认说明影响范围；发布后 2s 内在市场页可检索，下线后调用控件禁用
- 额度管理：
  - 增配确认弹窗说明生效范围；成功后剩余额度即时刷新并动画高亮差值
  - 最近变更记录就地可见（时间/操作者/数量）
- AK/SK 管理：
  - 脱敏显示仅前后 4 位；复制前二次确认；复制后 3s 内可撤销
  - 重置需输入“RESET”或显式确认，提示“旧 SK 失效”
- 帖子创建/审核：
  - 草稿 10s 自动保存并显示“上次保存时间”
  - 审核态/驳回原因就近呈现；编辑后可“重新提交审核”

### 12. 验收用例（E2E 抽样）
1) 非法 JSON Schema 即时标红并定位错误行；修正后 300ms 内转为通过。
2) 调试台在无 `requestSchema` 时提供 JSON 编辑器并做基础语法校验；调用成功展示耗时与复制按钮。
3) 接口下线后，市场详情“调用”按钮禁用并展示原因 Tooltip。
4) 增加额度后，用户“我的接口”剩余额度即时刷新；刷新页面后仍正确。
5) 未保存编辑直接离开路由触发确认；选择“仍然离开”后不再提示。
6) 仅用键盘可完成 登录→搜索→打开详情→发起调用 全流程。
7) 401 统一跳转登录，登录成功后重定向回原页面。
8) 5xx 错误展示“重试”按钮；离线横幅出现，恢复网络后自动重试一次。
9) AK/SK 复制需二次确认，复制后 Toast 提示并 3s 内可撤销。
10) 列表分页/排序写入 URL；刷新后状态保持。

### 13. 评分与通过阈值
- Must（必需）：含“必须/二次确认/禁用/即时校验”的条款合格率 ≥ 95%
- Should（应有）：快捷键/就地编辑/列控制/动效等合格率 ≥ 85%
- Could（可选）：PWA/预取/移动端完善等合格率 ≥ 70%
- 用户任务效率：核心 6 任务（登录、检索、调试、发布/下线、增配、AK/SK）每个 ≤ 5 步，误操作率 < 2%
- 主观满意度：CSAT ≥ 4.2/5；SUS ≥ 75

### 14. 里程碑（建议）
- M1（1 周）：脚手架、认证闭环、API 列表/详情
- M2（1 周）：在线调试台、接口管理（增/改/删/发/下）
- M3（1 周）：额度管理、个人中心（AK/SK）、帖子
- M4（0.5 周）：运营看板 v1、E2E 完整链路
- M5（0.5 周）：性能优化、验收与上线

### 15. 风险与缓解
- Schema 质量参差 → JSON 校验 + 模板示例；后端入库校验兜底
- 跨域/鉴权 → 统一 `/api` 代理；严控敏感头；后端签名与网关控制
- 运营数据接口缺失 → 先前端埋点与日志离线聚合，后续补齐网关指标接口

### 16. 交付物清单
- Vue 源码（用户门户 + 管理后台）
- `.env` 样例、构建脚本、可选 Dockerfile
- 测试用例（单测/组件/集成/E2E）与报告
- CI/CD 配置（Lint/Build/Test/Artifact/Deploy）
- 快速起步文档（环境变量、运行、打包）


